<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Seller Shopee</title>
    
    <meta name="theme-color" content="#EE4D2D">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkNhbGN1bGFkb3JhIFNob3BlZSIsCiAgInNob3J0X25hbWUiOiAiU2hvcGVlQ2FsYyIsCiAgInN0YXJ0X3VybCI6ICIuIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjRkZGRkZGIiwKICAidGhlbWVfY29sb3IiOiAiI0VFNUQyRCIsCiAgImljb25zIjogW3sgInNyYyI6ICJodHRwczovL2Nkbi1pY29ucy1wbmcuZmxhdGljb24uY29tLzUxMi8zODIzLzM4MjMyMjUucG5nIiwgInNpemVzIjogIjUxMng1MTIiLCAidHlwZSI6ICJpbWFnZS9wbmciIH1dCn0=">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --shopee-orange: #EE4D2D;
            --shopee-light-gray: #f5f5f5;
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--shopee-light-gray);
            margin: 0;
            padding: 15px;
            color: #333;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: var(--white);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header img {
            max-width: 150px;
        }

        .input-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: bold;
            color: #555;
            margin-bottom: 4px;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1rem;
            outline: none;
        }

        input:focus {
            border-color: var(--shopee-orange);
        }

        .results {
            background: #fff8f6;
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed var(--shopee-orange);
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .result-item b {
            color: var(--shopee-orange);
        }

        .btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: 0.3s;
        }

        .btn-calc {
            background-color: var(--shopee-orange);
            color: white;
            grid-column: span 2;
            font-size: 1.1rem;
        }

        .btn-memory { background-color: #333; color: white; }
        .btn-save { background-color: #00bfa5; color: white; }

        #memoriaCalculo {
            display: none;
            background: #eee;
            padding: 10px;
            font-family: monospace;
            font-size: 0.8rem;
            margin-top: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<div class="container" id="capture">
    <div class="header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/f/fe/Shopee.svg" alt="Shopee Logo">
        <h2 style="color: var(--shopee-orange); margin: 5px 0;">Calculadora de Preços</h2>
    </div>

    <div class="input-group">
        <label>Custo Unitário (R$)</label>
        <input type="number" id="custo" placeholder="0,00" step="0.01">
    </div>

    <div class="input-group">
        <label>Quantidade</label>
        <input type="number" id="quantidade" value="1">
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <div class="input-group">
            <label>Imposto (%)</label>
            <input type="number" id="imposto" value="6">
        </div>
        <div class="input-group">
            <label>Comissão Shopee (%)</label>
            <input type="number" id="comissao" value="20">
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <div class="input-group">
            <label>Margem Lucro (%)</label>
            <input type="number" id="margem" value="15">
        </div>
        <div class="input-group">
            <label>Desconto (%)</label>
            <input type="number" id="desconto" value="0">
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <div class="input-group">
            <label>Antecipação (%)</label>
            <input type="number" id="antecipacao" value="0">
        </div>
        <div class="input-group">
            <label>Taxa Evento Oficial (%)</label>
            <input type="number" id="evento" value="2">
        </div>
    </div>

    <button class="btn-calc" onclick="calcular()">CALCULAR PREÇO</button>

    <div class="results">
        <div class="result-item">
            <span>Total <b>Markdown</b>:</span>
            <span id="resMarkdown">R$ 0,00</span>
        </div>
        <div class="result-item">
            <span>Total <b>Markup</b>:</span>
            <span id="resMarkup">R$ 0,00</span>
        </div>
    </div>

    <div class="btn-row">
        <button class="btn-memory" onclick="toggleMemory()">MEMÓRIA</button>
        <button class="btn-save" onclick="salvarTela()">SALVAR TELA</button>
    </div>

    <div id="memoriaCalculo"></div>
</div>

<script>
    function calcular() {
        // Obter valores
        const custo = parseFloat(document.getElementById('custo').value) || 0;
        const qtd = parseFloat(document.getElementById('quantidade').value) || 1;
        const imposto = parseFloat(document.getElementById('imposto').value) / 100;
        const comissao = parseFloat(document.getElementById('comissao').value) / 100;
        const margem = parseFloat(document.getElementById('margem').value) / 100;
        const desconto = parseFloat(document.getElementById('desconto').value) / 100;
        const antecipacao = parseFloat(document.getElementById('antecipacao').value) / 100;
        const evento = parseFloat(document.getElementById('evento').value) / 100;

        const custoTotal = custo * qtd;

        // 1. Cálculo MARKUP (Baseado no custo)
        // PV = Custo * (1 + Somas das Taxas)
        const totalTaxasMarkup = imposto + comissao + margem + desconto + antecipacao + evento;
        const markupFinal = custoTotal * (1 + totalTaxasMarkup);

        // 2. Cálculo MARKDOWN (Baseado no preço de venda - Margem sobre a Receita)
        // PV = Custo / (1 - Somas das Taxas)
        const divisorMarkdown = 1 - (imposto + comissao + margem + desconto + antecipacao + evento);
        let markdownFinal = 0;
        if (divisorMarkdown > 0) {
            markdownFinal = custoTotal / divisorMarkdown;
        } else {
            markdownFinal = "Erro (Taxas > 100%)";
        }

        // Exibir resultados
        document.getElementById('resMarkup').innerText = typeof markupFinal === 'number' ? `R$ ${markupFinal.toFixed(2)}` : markupFinal;
        document.getElementById('resMarkdown').innerText = typeof markdownFinal === 'number' ? `R$ ${markdownFinal.toFixed(2)}` : markdownFinal;

        // Gerar Memória
        document.getElementById('memoriaCalculo').innerText = 
            `MEMÓRIA DE CÁLCULO:\n` +
            `Custo Base: R$ ${custoTotal.toFixed(2)}\n` +
            `Soma das Taxas: ${(totalTaxasMarkup * 100).toFixed(2)}%\n` +
            `---------------------------\n` +
            `Markup: Custo * (1 + Taxas)\n` +
            `Markdown: Custo / (1 - Taxas)`;
    }

    function toggleMemory() {
        const mem = document.getElementById('memoriaCalculo');
        mem.style.display = mem.style.display === 'block' ? 'none' : 'block';
    }

    function salvarTela() {
        html2canvas(document.getElementById('capture')).then(canvas => {
            const link = document.createElement('a');
            link.download = 'calculo-shopee.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    // Registro do Service Worker para PWA
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').catch(() => {});
    }
</script>

</body>
</html>